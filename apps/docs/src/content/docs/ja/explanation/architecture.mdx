---
title: ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
description: Hatago MCP Hubã®è¨­è¨ˆæ€æƒ³ã¨å†…éƒ¨æ§‹é€ ã‚’ç†è§£ã™ã‚‹
audience: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ·±ãç†è§£ã—ãŸã„é–‹ç™ºè€…
prerequisites: MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®åŸºæœ¬çš„ãªç†è§£
sidebar:
  order: 1
manual: true
---

import { Card, CardGrid, Aside } from '@astrojs/starlight/components';

Hatago MCP Hubã¯ã€è¤‡æ•°ã®MCPã‚µãƒ¼ãƒãƒ¼ã‚’çµ±åˆç®¡ç†ã™ã‚‹ãŸã‚ã®è»½é‡ãªãƒãƒ–ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ã•ã¨æ‹¡å¼µæ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸè¨­è¨ˆã«ãªã£ã¦ã„ã¾ã™ã€‚

## ğŸ¯ è¨­è¨ˆæ€æƒ³

Hatagoã®è¨­è¨ˆã¯ä»¥ä¸‹ã®åŸå‰‡ã«åŸºã¥ã„ã¦ã„ã¾ã™ï¼š

<CardGrid>
  <Card title="è»½é‡æ€§" icon="rocket">
    å¿…è¦æœ€å°é™ã®æ©Ÿèƒ½ã«é›†ä¸­ã—ã€ã‚³ã‚¢å®Ÿè£…ã‚’ç´„500è¡Œã«åã‚ã‚‹
  </Card>
  <Card title="æ‹¡å¼µæ€§" icon="puzzle">
    æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ—ã‚„ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆã‚’ç°¡å˜ã«è¿½åŠ å¯èƒ½
  </Card>
  <Card title="é€éæ€§" icon="magnifier">
    MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’é€éçš„ã«ä¸­ç¶™ã—ã€ä¸å¿…è¦ãªå¤‰æ›ã‚’é¿ã‘ã‚‹
  </Card>
  <Card title="ç‹¬ç«‹æ€§" icon="shield">
    å„ã‚µãƒ¼ãƒãƒ¼ã¯ç‹¬ç«‹ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã§å‹•ä½œã—ã€ç›¸äº’ã«å½±éŸ¿ã—ãªã„
  </Card>
</CardGrid>

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```mermaid
graph TB
    subgraph "AIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"
        CC[Claude Code]
        CX[Codex CLI]
        CR[Cursor]
        WS[Windsurf]
    end

    subgraph "Hatago MCP Hub"
        HUB[Hub Core<br/>ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»é›†ç´„]
        SM[Session Manager<br/>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†]
        SR[Server Registry<br/>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†]
        TR[Tool Registry<br/>ãƒ„ãƒ¼ãƒ«ç®¡ç†]
        RR[Resource Registry<br/>ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†]
    end

    subgraph "ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤"
        STDIO[STDIO]
        HTTP[HTTP]
        SSE[SSE]
        WebSocket[WebSocket]
    end

    subgraph "MCPã‚µãƒ¼ãƒãƒ¼"
        LS[Local Server<br/>ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ]
        NS[NPX Server<br/>npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸]
        RS[Remote Server<br/>HTTP/SSE]
    end

    CC --> STDIO
    CX --> STDIO
    CR --> HTTP
    WS --> HTTP

    STDIO --> HUB
    HTTP --> HUB
    SSE --> HUB
    WebSocket --> HUB

    HUB --> SM
    HUB --> SR
    HUB --> TR
    HUB --> RR

    SR --> LS
    SR --> NS
    SR --> RS
```

## ğŸ“¦ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ¢ãƒãƒ¬ãƒæ§‹é€ ã§ã€å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒæ˜ç¢ºãªè²¬å‹™ã‚’æŒã¡ã¾ã™ï¼š

### ã‚³ã‚¢ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸                   | è²¬å‹™              | ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«          |
| ---------------------------- | ----------------- | --------------------- |
| `@himorishige/hatago-hub`    | Hubæœ¬ä½“ã®å®Ÿè£…     | `hub.ts` (~500è¡Œ)     |
| `@himorishige/hatago-server` | ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ã¨CLI | `server.ts`, `cli.ts` |
| `@himorishige/hatago-core`   | å…±é€šã®å‹å®šç¾©      | `types.ts`            |

### ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸                      | è²¬å‹™                     | å½¹å‰²                         |
| ------------------------------- | ------------------------ | ---------------------------- |
| `@himorishige/hatago-runtime`   | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªç®¡ç†   |
| `@himorishige/hatago-transport` | é€šä¿¡å±¤                   | STDIO, HTTP, SSEå®Ÿè£…         |
| `@himorishige/hatago-mcp-hub`   | ãƒ¡ã‚¤ãƒ³npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸      | ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ |

### ä¾å­˜é–¢ä¿‚

```mermaid
graph BT
    core[hatago-core<br/>å‹å®šç¾©]
    runtime[hatago-runtime<br/>ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ]
    transport[hatago-transport<br/>é€šä¿¡]
    hub[hatago-hub<br/>Hubå®Ÿè£…]
    server[hatago-server<br/>ã‚µãƒ¼ãƒãƒ¼]
    main[hatago-mcp-hub<br/>ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸]

    runtime --> core
    transport --> core
    hub --> runtime
    hub --> transport
    server --> hub
    main --> server
```

## ğŸ”§ ã‚³ã‚¢ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### Hubï¼ˆä¸­æ ¸ï¼‰

Hubã¯å…¨ä½“ã®èª¿æ•´å½¹ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ï¼š

```typescript
class Hub {
  // ã‚µãƒ¼ãƒãƒ¼ç®¡ç†
  async start(options: HubOptions): Promise<void>;
  async stop(): Promise<void>;

  // ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
  async handleRequest(request: JSONRPCRequest): Promise<JSONRPCResponse>;

  // é€šçŸ¥è»¢é€
  async forwardNotification(notification: JSONRPCNotification): void;
}
```

**ä¸»è¦ãªè²¬å‹™ï¼š**

- ã‚µãƒ¼ãƒãƒ¼ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é©åˆ‡ãªã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ãƒ„ãƒ¼ãƒ«/ãƒªã‚½ãƒ¼ã‚¹/ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®é›†ç´„
- é€šçŸ¥ã®é€éçš„ãªè»¢é€

### Server Registry

ç•°ãªã‚‹ã‚¿ã‚¤ãƒ—ã®ã‚µãƒ¼ãƒãƒ¼ã‚’çµ±ä¸€çš„ã«ç®¡ç†ï¼š

```typescript
interface ServerRegistry {
  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼‰
  registerLocal(id: string, config: LocalConfig): void;

  // NPXã‚µãƒ¼ãƒãƒ¼ï¼ˆnpmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰
  registerNPX(id: string, config: NPXConfig): void;

  // ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ï¼ˆHTTP/SSEï¼‰
  registerRemote(id: string, config: RemoteConfig): void;
}
```

### Session Manager

è¤‡æ•°ã®AIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åŒæ™‚æ¥ç¶šã‚’ã‚µãƒãƒ¼ãƒˆï¼š

```typescript
interface SessionManager {
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
  createSession(clientId: string): Session;

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã®ã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  getServerInstance(sessionId: string, serverId: string): MCPServer;

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  destroySession(sessionId: string): void;
}
```

<Aside type="tip">
  å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æŒã¤ãŸã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ãŒæ··åœ¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
</Aside>

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant C as Client
    participant T as Transport
    participant H as Hub
    participant R as Registry
    participant S as MCP Server

    C->>T: Request
    T->>H: Parse & Validate
    H->>R: Lookup Tool/Resource
    R->>S: Route to Server
    S-->>R: Response
    R-->>H: Aggregate
    H-->>T: Format
    T-->>C: Response
```

### é€šçŸ¥è»¢é€ãƒ•ãƒ­ãƒ¼

é€²æ—é€šçŸ¥ãªã©ã‚’é€éçš„ã«è»¢é€ï¼š

```mermaid
sequenceDiagram
    participant S as Child Server
    participant H as Hub
    participant T as Transport
    participant C as Client

    S->>H: notifications/progress
    H->>H: Session Lookup
    H->>T: Forward
    T->>C: Deliver
```

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### ãƒ—ãƒ­ã‚»ã‚¹åˆ†é›¢

å„MCPã‚µãƒ¼ãƒãƒ¼ã¯ç‹¬ç«‹ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã§å®Ÿè¡Œï¼š

- ãƒ¡ãƒ¢ãƒªç©ºé–“ã®åˆ†é›¢
- ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã®å±€æ‰€åŒ–
- ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã®å€‹åˆ¥è¨­å®š

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

```typescript
// ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºæœ‰ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
interface SessionContext {
  id: string; // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ID
  clientId: string; // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè­˜åˆ¥å­
  servers: Map<string, MCPServer>; // å°‚ç”¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  createdAt: Date; // ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚åˆ»
}
```

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### é…å»¶åˆæœŸåŒ–

ã‚µãƒ¼ãƒãƒ¼ã¯å¿…è¦ã«ãªã‚‹ã¾ã§èµ·å‹•ã—ãªã„ï¼š

```typescript
// å®Ÿéš›ã«ãƒ„ãƒ¼ãƒ«ãŒå‘¼ã°ã‚Œã‚‹ã¾ã§ã‚µãƒ¼ãƒãƒ¼ã¯èµ·å‹•ã—ãªã„
async callTool(name: string, args: any) {
  const server = await this.lazyInitServer(name)
  return server.callTool(name, args)
}
```

### æ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°

ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã‚’å†åˆ©ç”¨ï¼š

```typescript
class ConnectionPool {
  private connections: Map<string, Connection>;

  async getConnection(url: string): Promise<Connection> {
    // æ—¢å­˜ã®æ¥ç¶šã‚’å†åˆ©ç”¨
    if (this.connections.has(url)) {
      return this.connections.get(url);
    }
    // æ–°è¦æ¥ç¶šã‚’ä½œæˆã—ã¦ãƒ—ãƒ¼ãƒ«
    const conn = await this.createConnection(url);
    this.connections.set(url, conn);
    return conn;
  }
}
```

## ğŸ”Œ æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

### æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ—ã®è¿½åŠ 

1. `MCPServer`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…
2. `ServerRegistry`ã«ç™»éŒ²
3. è¨­å®šã‚¹ã‚­ãƒ¼ãƒã‚’æ›´æ–°

```typescript
class CustomServer implements MCPServer {
  async initialize(config: CustomConfig) {
    /* ... */
  }
  async listTools() {
    /* ... */
  }
  async callTool(name: string, args: any) {
    /* ... */
  }
}

registry.register('custom', CustomServer);
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆ

```typescript
class CustomTransport implements Transport {
  async send(message: JSONRPCMessage) {
    /* ... */
  }
  async receive(): Promise<JSONRPCMessage> {
    /* ... */
  }
}
```

## ğŸ“ˆ ãƒãƒ¼ã‚¸ãƒ§ãƒ³é€²åŒ–

### v0.0.1 â†’ v0.0.2

ä¸»ãªæ”¹å–„ç‚¹ï¼š

- ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
- 38ä»¥ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦ã‚·ãƒ³ãƒ—ãƒ«åŒ–
- ã‚³ã‚¢å®Ÿè£…ã‚’1000è¡Œä»¥ä¸Šã‹ã‚‰ç´„500è¡Œã«å‰Šæ¸›

### å°†æ¥ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

<CardGrid>
  <Card title="çŸ­æœŸ" icon="clock">
    - Bun/Denoãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆ - ã‚¨ãƒ©ãƒ¼å›å¾©ã®å¼·åŒ– - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
  </Card>
  <Card title="é•·æœŸ" icon="rocket">
    - WebAssemblyã‚µãƒãƒ¼ãƒˆ - ãƒ–ãƒ©ã‚¦ã‚¶ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  - åˆ†æ•£ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
  </Card>
</CardGrid>

## ğŸ” å†…éƒ¨ãƒªã‚½ãƒ¼ã‚¹

Hatago ã«ã¯æœ€å°é™ã®å†…éƒ¨ãƒªã‚½ãƒ¼ã‚¹ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ï¼š

- `hatago://servers` â€” ç¾åœ¨æ¥ç¶šä¸­ã®ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§ã‚’ JSON ã§æä¾›ã—ã¾ã™ã€‚

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

<CardGrid>
  <Card title="MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«" icon="document" href="https://modelcontextprotocol.io/">
    å…¬å¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚µã‚¤ãƒˆ
  </Card>
  <Card title="ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼" icon="arrow-right" href="/ja/explanation/data-flow/">
    è©³ç´°ãªãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ
  </Card>
  <Card title="è¨­å®šãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹" icon="setting" href="/ja/reference/config/">
    è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§
  </Card>
</CardGrid>
