---
title: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã¨è¦³æ¸¬ãƒã‚¤ãƒ³ãƒˆ
description: Hatago MCP Hubã®ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã€è¦³æ¸¬å¯èƒ½ãªãƒã‚¤ãƒ³ãƒˆã€å¤±æ•—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è©³ç´°
version: '0.0.2+'
prerequisites: ['MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®åŸºæœ¬ç†è§£']
time_to_complete: '10åˆ†'
difficulty: 'ä¸­ç´š'
manual: true
sidebar:
  order: 2
---

import { Card, CardGrid, Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

Hatago MCP Hubã‚’çµŒç”±ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

## ğŸ“Š åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### æœ€å°æ§‹æˆ

```mermaid
flowchart LR
    Client[AIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ<br/>Claude/Cursor]
    Hub[Hatago Hub<br/>ğŸ“è¦³æ¸¬ç‚¹1]
    Server[MCPã‚µãƒ¼ãƒãƒ¼<br/>ğŸ“è¦³æ¸¬ç‚¹2]

    Client -->|1. Request<br/>JSON-RPC| Hub
    Hub -->|2. Forward<br/>å¤‰æ›æ¸ˆ| Server
    Server -->|3. Response| Hub
    Hub -->|4. Aggregate<br/>é›†ç´„æ¸ˆ| Client

    style Hub fill:#ff6b35,stroke:#333,stroke-width:2px
    style Client fill:#e8f4fd
    style Server fill:#e8f4fd
```

### è¦³æ¸¬å¯èƒ½ãªãƒã‚¤ãƒ³ãƒˆ

| è¦³æ¸¬ç‚¹                | å–å¾—ã§ãã‚‹æƒ…å ±                 | å…¸å‹çš„ãªã‚¨ãƒ©ãƒ¼           | ãƒ­ã‚°ã‚³ãƒãƒ³ãƒ‰        |
| --------------------- | ------------------------------ | ------------------------ | ------------------- |
| **ğŸ“1: Hubå…¥åŠ›**      | ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— | JSONè§£æã‚¨ãƒ©ãƒ¼ã€èªè¨¼å¤±æ•— | `--verbose`         |
| **ğŸ“2: ã‚µãƒ¼ãƒãƒ¼é€šä¿¡** | è»¢é€å†…å®¹ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“       | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€æ¥ç¶šæ‹’å¦   | `--log-level debug` |
| **ğŸ“3: Hubå‡ºåŠ›**      | é›†ç´„çµæœã€ã‚¨ãƒ©ãƒ¼å†…å®¹           | é›†ç´„ã‚¨ãƒ©ãƒ¼ã€å¤‰æ›å¤±æ•—     | `--verbose`         |

## ğŸ”„ è©³ç´°ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒ­ãƒ¼

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã®æµã‚Œ

```mermaid
sequenceDiagram
    participant C as Client
    participant H as Hub
    participant S1 as Server 1
    participant S2 as Server 2

    C->>H: tools/list
    Note over H: ğŸ“ãƒ­ã‚°: Request received

    par ä¸¦åˆ—å‡¦ç†
        H->>S1: tools/list
        Note over S1: å‡¦ç†
        S1-->>H: [tool1, tool2]
    and
        H->>S2: tools/list
        Note over S2: å‡¦ç†
        S2-->>H: [tool3, tool4]
    end

    Note over H: ğŸ“ãƒ­ã‚°: Aggregating results
    H-->>C: [tool1, tool2, tool3, tool4]
    Note over H: ğŸ“ãƒ­ã‚°: Response sent
```

### ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start[ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡] --> Parse{JSONè§£æ}
    Parse -->|æˆåŠŸ| Route[ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°]
    Parse -->|å¤±æ•—| E1[ã‚¨ãƒ©ãƒ¼: Invalid JSON<br/>ğŸ“è¦³æ¸¬ç‚¹: Hubå…¥åŠ›]

    Route --> Auth{èªè¨¼ç¢ºèª}
    Auth -->|æˆåŠŸ| Forward[ã‚µãƒ¼ãƒãƒ¼è»¢é€]
    Auth -->|å¤±æ•—| E2[ã‚¨ãƒ©ãƒ¼: Unauthorized<br/>ğŸ“è¦³æ¸¬ç‚¹: Hubèªè¨¼]

    Forward --> Response{ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾…æ©Ÿ}
    Response -->|æˆåŠŸ| Aggregate[çµæœé›†ç´„]
    Response -->|ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ| E3[ã‚¨ãƒ©ãƒ¼: Timeout<br/>ğŸ“è¦³æ¸¬ç‚¹: ã‚µãƒ¼ãƒãƒ¼é€šä¿¡]
    Response -->|æ¥ç¶šå¤±æ•—| E4[ã‚¨ãƒ©ãƒ¼: Connection Failed<br/>ğŸ“è¦³æ¸¬ç‚¹: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯]

    Aggregate --> Send[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé€ä¿¡]
    Send -->|æˆåŠŸ| End[å®Œäº†]
    Send -->|å¤±æ•—| E5[ã‚¨ãƒ©ãƒ¼: Send Failed<br/>ğŸ“è¦³æ¸¬ç‚¹: Hubå‡ºåŠ›]

    style E1 fill:#ffcccc
    style E2 fill:#ffcccc
    style E3 fill:#ffcccc
    style E4 fill:#ffcccc
    style E5 fill:#ffcccc
```

## ğŸ” è¦³æ¸¬æ–¹æ³•

### 1. ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åˆ¥ã®æƒ…å ±

<Tabs>
<TabItem label="infoï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰">
```bash
hatago serve --log-level info

# è¡¨ç¤ºã•ã‚Œã‚‹æƒ…å ±:

# - ã‚µãƒ¼ãƒãƒ¼èµ·å‹•/åœæ­¢

# - ä¸»è¦ãªã‚¨ãƒ©ãƒ¼

# - æ¥ç¶šçŠ¶æ…‹ã®å¤‰åŒ–

```

**ä¾‹:**
```

[INFO] Starting server: filesystem-local
[INFO] Hub ready on stdio
[ERROR] Server 'api-server' failed to start: Connection refused

````
</TabItem>

<TabItem label="debug">
```bash
hatago serve --log-level debug

# è¡¨ç¤ºã•ã‚Œã‚‹æƒ…å ±:
# - ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹
# - å†…éƒ¨å‡¦ç†ã®è©³ç´°
# - ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±
````

**ä¾‹:**

```
[DEBUG] Received request: {"jsonrpc":"2.0","method":"tools/list","id":1}
[DEBUG] Forwarding to server: filesystem-local
[DEBUG] Server response (125ms): {"result":[...]}
[DEBUG] Aggregated response sent to client
```

</TabItem>

<TabItem label="verbose">
```bash
hatago serve --verbose

# è¡¨ç¤ºã•ã‚Œã‚‹æƒ…å ±:

# - debugãƒ¬ãƒ™ãƒ«ï¼‹

# - ç’°å¢ƒå¤‰æ•°ã®å±•é–‹

# - è¨­å®šã®è§£æéç¨‹

```

**ä¾‹:**
```

[VERBOSE] Expanding env var: ${NODE_ENV} -> development
[VERBOSE] Loading config from: ./hatago-config.json
[VERBOSE] Parsed 3 servers, 2 active after tag filtering

````
</TabItem>
</Tabs>

### 2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–

```bash
# ãƒ­ã‚°ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã—ãªãŒã‚‰ç›£è¦–
hatago serve --verbose 2>&1 | tee hatago.log

# ç‰¹å®šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç›£è¦–
hatago serve --verbose 2>&1 | grep -E "(ERROR|WARN|timeout)"

# ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã§è¨˜éŒ²
hatago serve --verbose 2>&1 | ts '[%Y-%m-%d %H:%M:%S]'
````

### 3. ãƒ¡ãƒˆãƒªã‚¯ã‚¹å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```javascript title="scripts/monitor-hatago.js"
const { spawn } = require('child_process');
const readline = require('readline');

const metrics = {
  requests: 0,
  responses: 0,
  errors: 0,
  totalTime: 0,
  serverStats: {}
};

const hatago = spawn('npx', ['hatago', 'serve', '--verbose'], {
  stdio: ['pipe', 'pipe', 'pipe']
});

const rl = readline.createInterface({
  input: hatago.stderr,
  crlfDelay: Infinity
});

rl.on('line', (line) => {
  // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚«ã‚¦ãƒ³ãƒˆ
  if (line.includes('Received request')) {
    metrics.requests++;
  }

  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚«ã‚¦ãƒ³ãƒˆ
  if (line.includes('Response sent')) {
    metrics.responses++;
  }

  // ã‚¨ãƒ©ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆ
  if (line.includes('ERROR')) {
    metrics.errors++;
  }

  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®æŠ½å‡º
  const timeMatch = line.match(/\((\d+)ms\)/);
  if (timeMatch) {
    metrics.totalTime += parseInt(timeMatch[1]);
  }

  // å®šæœŸçš„ã«çµ±è¨ˆã‚’å‡ºåŠ›
  if (metrics.requests % 10 === 0) {
    console.log('ğŸ“Š ãƒ¡ãƒˆãƒªã‚¯ã‚¹:', {
      ...metrics,
      avgTime: metrics.totalTime / metrics.responses || 0
    });
  }
});
```

## ğŸš¨ å¤±æ•—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¨ºæ–­

### ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã‚¨ãƒ©ãƒ¼è¨ºæ–­è¡¨

| ãƒ¬ã‚¤ãƒ¤ãƒ¼            | ã‚¨ãƒ©ãƒ¼ç—‡çŠ¶          | è¨ºæ–­ã‚³ãƒãƒ³ãƒ‰                     | ä¸€æ¬¡å¯¾å¿œ                     |
| ------------------- | ------------------- | -------------------------------- | ---------------------------- |
| **1. èµ·å‹•**         | `command not found` | `which hatago`                   | PATHã‚’ç¢ºèªã€å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«   |
| **2. è¨­å®šèª­è¾¼**     | `Invalid config`    | `cat hatago-config.json \| jq .` | JSONæ§‹æ–‡ã‚’ä¿®æ­£               |
| **3. ç’°å¢ƒå¤‰æ•°**     | `${VAR} not found`  | `echo $VAR`                      | exportè¨­å®šã€.envãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª |
| **4. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•** | `spawn ENOENT`      | `ls -la $(which npx)`            | ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ã‚’çµ¶å¯¾ãƒ‘ã‚¹ã«     |
| **5. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯** | `ECONNREFUSED`      | `curl -I <url>`                  | URLç¢ºèªã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«    |
| **6. èªè¨¼**         | `401 Unauthorized`  | `echo $API_TOKEN`                | ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®šã€æœ‰åŠ¹æœŸé™ç¢ºèª   |
| **7. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ** | `Request timeout`   | `time curl <url>`                | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ã‚’å¢—ã‚„ã™       |

### ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç®‡æ‰€ã®ç‰¹å®šãƒ•ãƒ­ãƒ¼

<Steps>
1. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¢ºèª**
   ```bash
   hatago serve --verbose 2>&1 | grep -A5 -B5 ERROR
   ```

2. **è©²å½“ã‚µãƒ¼ãƒãƒ¼ã®å€‹åˆ¥ãƒ†ã‚¹ãƒˆ**

   ```bash
   # å•é¡Œã®ã‚µãƒ¼ãƒãƒ¼ã ã‘ã‚’æœ‰åŠ¹åŒ–
   hatago serve --tags problem-server --verbose
   ```

3. **ç›´æ¥å®Ÿè¡Œãƒ†ã‚¹ãƒˆ**

   ```bash
   # Hubã‚’ä»‹ã•ãšç›´æ¥å®Ÿè¡Œ
   npx @modelcontextprotocol/server-filesystem .
   ```

4. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨ºæ–­**

   ```bash
   # æ¥ç¶šæ€§ç¢ºèª
   nc -zv api.example.com 443

   # DNSè§£æ±ºç¢ºèª
   nslookup api.example.com
   ```
</Steps>

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ

### ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š

```mermaid
flowchart LR
    subgraph æ¸¬å®šãƒã‚¤ãƒ³ãƒˆ
        T1[å—ä¿¡æ™‚åˆ»<br/>t1]
        T2[è»¢é€é–‹å§‹<br/>t2]
        T3[å¿œç­”å—ä¿¡<br/>t3]
        T4[é€ä¿¡å®Œäº†<br/>t4]
    end

    subgraph æ‰€è¦æ™‚é–“
        D1[Hubå‡¦ç†<br/>t2-t1]
        D2[ã‚µãƒ¼ãƒãƒ¼å‡¦ç†<br/>t3-t2]
        D3[é›†ç´„å‡¦ç†<br/>t4-t3]
    end

    T1 --> D1
    T2 --> D2
    T3 --> D3
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°ã®è§£æ

```bash
# ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ã‚’æŠ½å‡º
hatago serve --verbose 2>&1 | \
  grep -oP '\(\K\d+(?=ms)' | \
  awk '{sum+=$1; count++} END {print "å¹³å‡å¿œç­”æ™‚é–“: " sum/count "ms"}'

# ã‚µãƒ¼ãƒãƒ¼åˆ¥ã®å¿œç­”æ™‚é–“
hatago serve --verbose 2>&1 | \
  grep -E "Server .+ response" | \
  awk '{print $2, $4}' | \
  sort | uniq -c
```

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«

### è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash title="scripts/diagnose-hatago.sh"
#!/bin/bash

echo "ğŸ” Hatagoè¨ºæ–­é–‹å§‹..."

# 1. ç’°å¢ƒãƒã‚§ãƒƒã‚¯
echo -e "\nğŸ“‹ ç’°å¢ƒæƒ…å ±:"
echo "Node.js: $(node --version)"
echo "npm: $(npm --version)"
echo "Hatago: $(npx hatago --version 2>/dev/null || echo 'Not installed')"

# 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
echo -e "\nğŸ“„ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«:"
if [ -f hatago-config.json ]; then
    jq . hatago-config.json >/dev/null 2>&1 && \
        echo "âœ… Valid JSON" || \
        echo "âŒ Invalid JSON"
    echo "ã‚µãƒ¼ãƒãƒ¼æ•°: $(jq '.mcpServers | length' hatago-config.json)"
else
    echo "âŒ hatago-config.json not found"
fi

# 3. ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯
echo -e "\nğŸ” ç’°å¢ƒå¤‰æ•°:"
for var in NODE_ENV GITHUB_TOKEN OPENAI_API_KEY; do
    if [ -z "${!var}" ]; then
        echo "âš ï¸  $var: Not set"
    else
        echo "âœ… $var: Set (${#var} chars)"
    fi
done

# 4. æ¥ç¶šãƒ†ã‚¹ãƒˆ
echo -e "\nğŸŒ æ¥ç¶šãƒ†ã‚¹ãƒˆ:"
echo '{"jsonrpc":"2.0","method":"_internal_hatago_status","id":1,"params":{}}' | \
    timeout 5 npx hatago serve --stdio 2>/dev/null | \
    jq -r '.result.status' | \
    grep -q "ready" && echo "âœ… Hub is ready" || echo "âŒ Hub not responding"

echo -e "\nâœ¨ è¨ºæ–­å®Œäº†"
```

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

<CardGrid>
  <Card title="ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°" icon="document" href="/ja/explanation/architecture/">
    ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã®è©³ç´°
  </Card>
  <Card title="ã‚¨ãƒ©ãƒ¼ã‚«ã‚¿ãƒ­ã‚°" icon="warning" href="/ja/troubleshooting/error-catalog/">
    å…¨ã‚¨ãƒ©ãƒ¼ä¸€è¦§ã¨å¯¾å‡¦æ³•
  </Card>
  <Card title="ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–" icon="rocket" href="/ja/how-to/performance/">
    é«˜é€ŸåŒ–ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯
  </Card>
</CardGrid>

<Aside type="tip">
  **ãƒ—ãƒ­ã®ãƒ’ãƒ³ãƒˆ**:
  `--verbose`ãƒ­ã‚°ã‚’Elasticsearchã‚„Datadogã«é€ä¿¡ã™ã‚‹ã“ã¨ã§ã€æœ¬æ ¼çš„ãªè¦³æ¸¬å¯èƒ½æ€§ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚
</Aside>
