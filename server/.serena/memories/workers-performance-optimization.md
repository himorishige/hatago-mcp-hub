# Cloudflare Workers パフォーマンス最適化

## 現状の問題

- コールドスタート時にdeepwikiへの接続に2-3秒かかる
- 毎回のリクエストでMcpHubの初期化とサーバー接続が発生
- Workers環境では接続の永続化が難しい

## 改善案

### 1. 接続の事前確立（Warming）

- Workers の Smart Placement を有効にして、よく使う地域に配置
- Cron Triggerで定期的にヘルスチェックを実行し、接続を温める

### 2. KV Storageでの接続状態キャッシュ

- 初期化済みの状態をKVに保存
- ただし、実際の接続オブジェクトは保存できないので効果は限定的

### 3. Durable Objectsの活用

- 永続的な接続を保持できる
- ただし、追加コストと複雑性が増す

### 4. ツールリストのキャッシュ強化

- 現在もキャッシュしているが、KVに保存して永続化
- TTLを設定して定期的に更新

### 5. 遅延初期化

- 最初のリクエストではツールリストのみ返す（キャッシュから）
- 実際のツール実行時に初めて接続を確立

### 6. 並列接続

- 複数のMCPサーバーへの接続を並列化（既に実装済み）

## 実装優先度

1. **ツールリストのKVキャッシュ** - 簡単で効果的
2. **Cron Trigger warming** - 設定だけで改善可能
3. **遅延初期化** - 初回レスポンスを高速化
4. **Durable Objects** - 本格的な改善が必要な場合
